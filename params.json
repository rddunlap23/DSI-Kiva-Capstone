{
  "name": "DSI Capstone - Kiva Microloans",
  "tagline": "Exploring Why Kiva Loans Expire",
  "body": "![Title](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/gh-pages/images/kiva-loans-life.jpg?raw=true)\r\n\r\n![About-Kiva](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/gh-pages/images/Kiva-Mission.png?raw=true)\r\n\r\n##Kiva Life of a Loan:\r\n[Kiva Loan Lifecycle](https://www.kiva.org/about/how)\r\n\r\nThe life of a loan generally follows the following lifecycle:\r\n\r\n1. Borrowers apply to a local Field Partner, which manages the loan on the ground. \r\n\r\n2. Partner loans are facilitated by local nonprofits or lending institutions, which approve the borrower’s loan request. Kiva does due diligence and ongoing monitoring for each of these Field Partners.\r\n\r\n3. Disbursal refers to when the borrower can access the money— the timing of this can vary. For most Field Partner loans, the money is pre-disbursed, so the borrower can access the funds right away. \r\n\r\n4. Depending on the type of loan, a Field Partner or borrower uploads the loan details into the \r\nsystem. Our worldwide network of volunteers then helps to edit and translate loans before they go live on the website for lenders to crowdfund.\r\n\r\n5. Lenders receive repayments over time, based on the given repayment schedule and the borrower’s ability to repay. The repayments go into the lenders’ Kiva accounts.\r\n\r\n6. Lenders use repayments to fund new loans, donate or withdraw the money.\r\n\r\n## Business Problem:\r\n\r\nIn 2012 Kiva instituted a policy where a loan has 30 days to be crowd-funded on the site before it expires. If after 30 days the loan is not fully funded the loan is flagged as expired and any money raised is returned to the lenders. If this happens the loan and the risk is beared by the loan partner. Per [Kiva's blog post](https://www.kiva.org/blog/kiva/2012/08/13/qa-expiring-loans-credit-limits-and-the-evolution-of-kiva.html) this was done for primarily two reasons:\r\n\r\n* So that posted loans reflect the reality on the ground. If a loan is on the site for too long a borrower could already be paying back the loan. \r\n* To help provide a feedback loop for field partners. If a field partner's loans are expiring that is a signal to them that they are not posting loans that are in demand by lenders on the site.  \r\n\r\nKiva's mission is to connect people through lending to alleviate poverty. To maximize their impact they want to ensure that they are helping to efficiently deploy users capital to as many aspiring entrepreneurs across the globe as possible. If Kiva can decrease the number of loans that go unfunded it will help them to reach more entrepreneurs and better execute on their mission to alleviate poverty. \r\n\r\nThe goal of this project is to build a model that will help predict if a loan is at risk of being funded. Armed with this knowledge Kiva can either work to feature these loans more prominently on the sight or work with field partners and borrowers to better present their loans to maximize demand and increase funding. \r\n\r\n# Exploratory Data Analysis (EDA)\r\n\r\n##Exploring Funded Kiva Loans\r\n\r\n![PointMap](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/point%20map.png?raw=True)\r\n[Click Here For Live Interactive Country Map](https://cdn.rawgit.com/rddunlap23/DSI-Kiva-Capstone/master/assets/point_map.html)\r\n\r\nFirst off before jumping into exploring who has trouble getting loans funded on Kiva I want to take a moment to explore the breakdown of the loans they do make. All of the below figures are for loans made from November 29th, 2011 through August 22nd, 2016. During this period Kiva made a total of 694,202 loans for  $588,538,975. As you can see from the below plots a few things stand out. (One note is that only displaying top 25 countries by $ loaned)\r\n\r\n* Considerably more loans are made to women than men. Almost 3:1\r\n* Agriculture, Retail, and Food are the most popular sectors making up greater than half of all dollars loaned\r\n* While Latin America and Sub Saharan Africa are the two regions receiving the most loans the top country is the Philippines which is in South East Asia. \r\n* Countries identified by the world bank as lower middle income receive the most loans with upper middle income countries coming in second. These are both ahead of countries flagged as low income. My initial guess here is that this is because the rule of law and strength of institutions make it easier to provide loans and start up a business in these countries. This is something that would definitely warrant further research to dig into. \r\n\r\n![gender_amount](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/gender_loaned.png?raw=True)\r\n![gender_count](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/gender_loan_count.png?raw=True)\r\n\r\n![sector_amount](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/sector_loaned.png?raw=True)\r\n![region_loaned](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/region_loaned.png?raw=True)\r\n![country_loaned](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/country_loaned.png?raw=True)\r\n![income_loaned](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/income_level_loaned.png?raw=True) \r\n\r\nI want to further dig into the breakdown of the average loan size by the same demographics. A few things that stand out here:\r\n\r\n* The disparity in average loan size by gender in most cases is relatively small. When you look by country where there is a larger discrepancy, with a few exceptions, it is women that are receiving the larger loans.\r\n* Congo stands out as the 2nd highest average loan size despite being one of the countries identified as low income by the World Bank. Digging in further retail, food, and clothing were the top sectors for the Congo though these sectors are towards the middle of the pack for Kiva overall.\r\n* Not surprisingly average loan size is positively correlated with income level.\r\n\r\n![sector_gender_avg](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/sectoravg_by_gender.png?raw=True)\r\n![region_gender_avg](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/regionavg_by_gender.png?raw=True)\r\n![country_gender_avg](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/countryavg_by_gender.png?raw=True)\r\n![income_gender_avg](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/income_levelavg_by_gender.png?raw=True)\r\n\r\n##Exploring Kiva Expired Loans\r\n\r\nNow that we have a feel for the profile of the loans made we want to start exploring which types of loans are the most likely to expire before being funded. In total there were 39,975 loans that expired for a total of $57,930,375. This make up ~5.4% of all loans. I want to start subsetting the data to see if we can tease out anything across demographics. (For countries only showing top 25 countries by total $ loaned) \r\n\r\nIf you look at the below histograms you can see that the expired loans distribution (red) is shifted to the right with a long right tail. This tells me that it is more difficult to get a larger $ loan funded. I will explore this further across demographics. \r\n\r\n![income-dist](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/loan_amount_dist.png?raw=true)\r\n\r\nWhen I look at the overall expiration rate across demographics a few things stand out. \r\n\r\n* Men have a much more difficult time getting loans funded. Overall ~12% of mens loans go unfunded while women only have ~3.2% of funds expire.\r\n* There is a clear trend that the higher income regions have a harder time getting funded. I suspect this is because the loans are altruistic in nature people are generally biased towards helping out those they feel need it most. \r\n* There are very large disparities across both sectors and countries. There is a > 10% disparity between the low end and the high for both of these demographics. \r\n\r\n![gender_expired](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/gender_expired_loans.png?raw=True)\r\n![sector_expired](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/sector_expired_loans.png?raw=True)\r\n![region_expired](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/region_expired_loans.png?raw=True)\r\n![country_expired](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/country_expired_loans.png?raw=True)\r\n![income_expired](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/income_level_expired_loans.png?raw=True)\r\n\r\nGiven that gender has such a large impact I want to subset each of the demographics by gender to see if there is anything that stands out. \r\n\r\n![sectors](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/sector.png?raw=true)\r\n![region](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/region.png?raw=true)\r\n![country](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/country.png?raw=true)\r\n![income-level](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/income_level.png?raw=true)\r\n\r\nThe expiration rate by gender across each of the demographics varies quite a bit. The fact that they're not more consistent tells me that there is an interaction impact here that I should look to include in the model. \r\n\r\nGiven that the loan size appears to make a difference in the % of loans that go un-funded I next want to take a look at our cross sections of gender, sector, region, country, and income level to see if the average loan size by funded vs unfunded similar across these demographics. \r\n\r\n![gender_avg](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/genderavg_loaned.png?raw=True)\r\n![sector_avg](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/sectoravg_loaned.png?raw=true)\r\n![region_avg](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/regionavg_loaned.png?raw=true)\r\n![country_avg](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/countryavg_loaned.png?raw=true)\r\n![income_avg](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/income_levelavg_loaned.png?raw=True)\r\n\r\nI also want to take a look at how the supply of loans impacts the likelihood of getting a loan funded. From the below histogram you can see that as the number of loans posted increases the likelihood of a loan going un-funded goes up (red)\r\n\r\n![loan-supply](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/No_Loans_dist.png?raw=True)\r\n\r\nLastly before moving on to building the model I want to take a look at the correlation matrix for the numerical data. If there are any features strongly correlated with the funding status they will likely be good candidates for the model. I also want to look at features that have a strong correlation with each other. I will need to eliminate any of these to make the model more stable. A couple of observations here:\r\n\r\n* Repayment term, loan amount, and number of competing loans have the strongest positive correlation with a loan going unfunded. \r\n* Gender and currency risk are the most strongly negatively correlated with a loan going unfunded. Given how these variables were encoded this implies being male (consistent with analysis above) and not having currency exposure (I would have guessed the opposite) make it harder to get a loan funded. \r\n* GDP and GDP per capita growth are very strongly negatively correlated. I'm going to need to remove one of these before I run my model. \r\n\r\n![corr_matrix](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/correlation_matrix.png?raw=True)\r\n\r\n# Modeling\r\n\r\n## Feature Engineering\r\n\r\nNow that I've explored the data visually and have a good sense of the breakdown across all of the different subsets/demographics I want to move on to building a model to help predict if a loan will be funded or not. There are going to be four main features that go into the model. They include:\r\n\r\n* Continuous data (Loan Amount, Number of competing loans, country tourism dollars, GNI per capita, GDP growth per capita, and number of lenders) \r\n* Categorical data (region, country, gender, sector, income level, and activity) which will be encoded into dummy variables of 1s and 0s so that they can be included in model. \r\n* The one sentence headline description which will be represented using a modeling statistic called [TF-IDF](https://en.wikipedia.org/wiki/Tf%E2%80%93idf). TF-IDF or term frequency - inverse document frequency is a method that counts the number of times a word appears in a document and then adjusted it down based on how many times that word appears across all documents in your corpus. This give more weights to words that are common in a document but not common across documents. This helps to highlight what is both important and unique about a document.\r\n* I will use Latent Dirichlet allocation (LDA) which is a statistical model for representing a document by a set of topic weights. So instead of representing a large corpus by 50k + columns, one for each word, each document is represented by a set of topic weights (I am using 20 topics) This is an unsupervised dimensionality reduction technique for representing large bodies of text. \r\n\r\nFrom the EDA that I did above one thing that stood out is that the default rates across the demographics (sector, country, and income level) varied considerably across gender. To capture this interaction I will include features such as gender * sector to capture if there is any variance that is not explained by gender and sector in isolation. \r\n\r\nDue to the extremely high correlation between GDP Growth and GDP per capita growth I will strip out the GDP growth. \r\n\r\n## Model Selection\r\n\r\nMy primary goal is to use this model to be able to not only predict if a loan is at risk of expiring but also to understand what puts it so that Kiva can take steps to improve the likelihood of the loan being funded by either helping the borrower restructure their application (online posting) so that it drives more demand or featuring the loan more prominently on the website to help increase demand. \r\n\r\nGiven that the why is equally if not more important than the prediction itself I am going to explore using a logistic regression classification model. This will tell me what feature have the greatest impact as well as if they are positively or negatively related to the outcome. \r\n\r\n## Model Tuning\r\n\r\nFor the tf-idf and LDA component of the model I want to chop off the most common and most rarely used words to help the model perform better. \r\n\r\nI want to get rid of the common words because if every single document has a given word multiple times it will not be helpful to identify what is unique about a given document and will provide very little variance or signal to be picked up in the model. Granted tf-idf already penalizes the most commonly used words in a corpus so they have a very small weight, but to help keep the feature set smaller and the potential overfitting that can result from this I will look to drop these out of the model all together. \r\n\r\nOn the other extreme I want to remove words that only appear in a few of the documents. This is to try to avoid overfitting where the model would be able to predict specific loans by effectively memorizing unique loans and not be able to generalize to new loans it has not seen. \r\n\r\nAfter some doing some histogram plotting for both the headline topic sentence and the description I settled on setting the minimum and maximum words counts for 150,1000 and 100,1600 respectively. \r\n\r\nThe next step was to do some hyperparameter optimization. I utilized scikit-learn's gridsearch to identify if using an L1(lasso) or L2(ridge) [regularization](https://en.wikipedia.org/wiki/Regularization_(mathematics)) yielded the best model as well the number of topics to use for the LDA (5,10 or 20). L1 and 20 topics yielded the most accurate model. \r\n\r\n## Model Evaluation\r\n\r\nNow that I have the model fitted and have optimized the hyperparameters used I want to start to look at evaluating how well the model performed. \r\n\r\nThe first classification metric I want to look at is the [ROC](http://blog.yhat.com/posts/roc-curves.html) curve. A score of 1 means the model is perfect as has 0 false positives. A score of 0.5 is what a naive model would do, effectively a coin flip. With a score of 0.92 I'm off to a good start. \r\n\r\n![ROC_curve](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/roc_curve.png?raw=True)\r\n\r\nGiven that this data set is heavily inbalanced with ~95% of loans being funded a better metric to focus on (that is not skewed by inbalance) is the [precision/recall curve](http://mlwiki.org/index.php/Precision_and_Recall). This measures the tradeoff of being correct when you guess a loan will expire (precision) versus correctly predicting every loan that expires(recall). Similar to the ROC curve the closer the area under the curve is to 1 the better. \r\n \r\n![precision_recall](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/precision_recall.png?raw=True)\r\n![confusion_matrix](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/confusion_matrix.png?raw=True)\r\n![confusion_normalized](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/confusion_matrix_normalized.png?raw=True)\r\n![feature_importance](https://github.com/rddunlap23/DSI-Kiva-Capstone/blob/master/assets/feature_importance.png?raw=True)",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}